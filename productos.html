<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Descubre nuestra amplia gama de productos de calidad en Credicálidda. Encuentra lo que necesitas con garantía y entrega rápida.">
    <meta name="keywords" content="productos, calidad, garantía, entrega rápida, Credicálidda">
    <title>Productos - Credicálidda</title>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="css/main.css" as="style">
    <link rel="preload" href="css/components.css" as="style">
    <link rel="preload" href="js/utils.js" as="script">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    
    <!-- Open Graph meta tags -->
    <meta property="og:title" content="Productos - Credicálidda">
    <meta property="og:description" content="Descubre nuestra amplia gama de productos de calidad en Credicálidda.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://credicalidda.com/productos.html">
    <meta property="og:image" content="images/og-products.jpg">
    
    <!-- Structured data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "Productos - Credicálidda",
        "description": "Descubre nuestra amplia gama de productos de calidad",
        "url": "https://credicalidda.com/productos.html",
        "mainEntity": {
            "@type": "ItemList",
            "name": "Productos Credicálidda",
            "description": "Lista de productos disponibles"
        }
    }
    </script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <!-- Logo -->
                <div class="logo">
                    <a href="index.html" aria-label="Ir al inicio">
                        <img src="images/logo.png" alt="Credicálidda" width="150" height="40">
                    </a>
                </div>
                
                <!-- Main Navigation -->
                <nav class="main-nav" role="navigation" aria-label="Navegación principal">
                    <ul class="nav-list">
                        <li><a href="index.html">Inicio</a></li>
                        <li><a href="productos.html" class="active">Productos</a></li>
                        <li><a href="nosotros.html">Nosotros</a></li>
                        <li><a href="contacto.html">Contacto</a></li>
                    </ul>
                </nav>
                
                <!-- Search Bar -->
                <div class="search-container">
                    <form class="search-form" role="search" aria-label="Buscar productos">
                        <input 
                            type="search" 
                            id="searchInput" 
                            placeholder="Buscar productos..." 
                            aria-label="Buscar productos"
                            autocomplete="off"
                        >
                        <button type="submit" aria-label="Buscar">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </button>
                    </form>
                </div>
                
                <!-- User Actions -->
                <div class="user-actions">
                    <button class="btn-icon cart-btn" aria-label="Carrito de compras">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="9" cy="21" r="1"></circle>
                            <circle cx="20" cy="21" r="1"></circle>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                        </svg>
                        <span class="cart-count">0</span>
                    </button>
                    
                    <button class="btn btn-primary" onclick="FormManager.openContactModal()">
                        Contactar
                    </button>
                </div>
                
                <!-- Mobile Menu Button -->
                <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Abrir menú">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-menu-content">
                <div class="mobile-menu-header">
                    <h3>Menú</h3>
                    <button class="mobile-menu-close" id="mobileMenuClose" aria-label="Cerrar menú">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                
                <nav class="mobile-nav">
                    <ul>
                        <li><a href="index.html">Inicio</a></li>
                        <li><a href="productos.html" class="active">Productos</a></li>
                        <li><a href="nosotros.html">Nosotros</a></li>
                        <li><a href="contacto.html">Contacto</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>
    
    <!-- Breadcrumb -->
    <nav class="breadcrumb" aria-label="Navegación de ruta">
        <div class="container">
            <ol class="breadcrumb-list">
                <li><a href="index.html">Inicio</a></li>
                <li aria-current="page">Productos</li>
            </ol>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <section class="page-header">
            <div class="container">
                <div class="page-header-content">
                    <h1>Nuestros Productos</h1>
                    <p>Descubre nuestra amplia gama de productos de calidad con garantía y entrega rápida</p>
                </div>
            </div>
        </section>
        
        <!-- Filters Section -->
        <section class="filters-section">
            <div class="container">
                <div class="filters-container">
                    <!-- Categories Filter -->
                    <div class="filter-group">
                        <h3>Categorías</h3>
                        <div class="filter-options">
                            <label class="filter-option">
                                <input type="checkbox" name="category" value="all" checked>
                                <span class="checkmark"></span>
                                Todas las categorías
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="category" value="electrodomesticos">
                                <span class="checkmark"></span>
                                Electrodomésticos
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="category" value="tecnologia">
                                <span class="checkmark"></span>
                                Tecnología
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="category" value="hogar">
                                <span class="checkmark"></span>
                                Hogar y Jardín
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="category" value="deportes">
                                <span class="checkmark"></span>
                                Deportes
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="category" value="vehiculos">
                                <span class="checkmark"></span>
                                Vehículos
                            </label>
                        </div>
                    </div>
                    
                    <!-- Price Range Filter -->
                    <div class="filter-group">
                        <h3>Rango de Precio</h3>
                        <div class="price-range">
                            <div class="price-inputs">
                                <input type="number" id="minPrice" placeholder="Mín" min="0" step="100">
                                <span>-</span>
                                <input type="number" id="maxPrice" placeholder="Máx" min="0" step="100">
                            </div>
                            <div class="price-slider">
                                <input type="range" id="priceRange" min="0" max="50000" step="1000" value="25000">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sort Options -->
                    <div class="filter-group">
                        <h3>Ordenar por</h3>
                        <select id="sortSelect" class="sort-select">
                            <option value="featured">Destacados</option>
                            <option value="price-low">Precio: Menor a Mayor</option>
                            <option value="price-high">Precio: Mayor a Menor</option>
                            <option value="name">Nombre A-Z</option>
                            <option value="newest">Más Nuevos</option>
                        </select>
                    </div>
                    
                    <!-- View Toggle -->
                    <div class="filter-group view-toggle">
                        <button class="view-btn active" data-view="grid" aria-label="Vista en cuadrícula">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <rect x="3" y="3" width="7" height="7"></rect>
                                <rect x="14" y="3" width="7" height="7"></rect>
                                <rect x="14" y="14" width="7" height="7"></rect>
                                <rect x="3" y="14" width="7" height="7"></rect>
                            </svg>
                        </button>
                        <button class="view-btn" data-view="list" aria-label="Vista en lista">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <line x1="8" y1="6" x2="21" y2="6"></line>
                                <line x1="8" y1="12" x2="21" y2="12"></line>
                                <line x1="8" y1="18" x2="21" y2="18"></line>
                                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                <line x1="3" y1="18" x2="3.01" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Active Filters -->
                <div class="active-filters" id="activeFilters" style="display: none;">
                    <h4>Filtros activos:</h4>
                    <div class="active-filter-tags"></div>
                    <button class="clear-filters" onclick="ProductsPage.clearAllFilters()">
                        Limpiar filtros
                    </button>
                </div>
            </div>
        </section>
        
        <!-- Products Grid -->
        <section class="products-section">
            <div class="container">
                <!-- Products Count -->
                <div class="products-header">
                    <p class="products-count">
                        Mostrando <span id="resultsCount">0</span> productos
                    </p>
                </div>
                
                <!-- Products Grid Container -->
                <div class="products-grid" id="productsGrid">
                    <!-- Products will be loaded here dynamically -->
                </div>
                
                <!-- Loading State -->
                <div class="loading-state" id="loadingState">
                    <div class="loading-spinner"></div>
                    <p>Cargando productos...</p>
                </div>
                
                <!-- No Results State -->
                <div class="no-results" id="noResults" style="display: none;">
                    <div class="no-results-icon">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </div>
                    <h3>No se encontraron productos</h3>
                    <p>Intenta ajustar tus filtros o términos de búsqueda</p>
                    <button class="btn btn-primary" onclick="ProductsPage.clearAllFilters()">
                        Limpiar filtros
                    </button>
                </div>
                
                <!-- Load More Button -->
                <div class="load-more-container" id="loadMoreContainer" style="display: none;">
                    <button class="btn btn-outline load-more-btn" id="loadMoreBtn">
                        Cargar más productos
                    </button>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <!-- Company Info -->
                <div class="footer-section">
                    <div class="footer-logo">
                        <img src="images/logo-white.png" alt="Credicálidda" width="150" height="40">
                    </div>
                    <p class="footer-description">
                        Tu marketplace de confianza para encontrar productos de calidad 
                        con garantía y entrega rápida en todo el país.
                    </p>
                    <div class="social-links">
                        <a href="#" aria-label="Facebook" class="social-link">
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                            </svg>
                        </a>
                        <a href="#" aria-label="Instagram" class="social-link">
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                            </svg>
                        </a>
                        <a href="#" aria-label="WhatsApp" class="social-link">
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.886 3.488"/>
                            </svg>
                        </a>
                    </div>
                </div>
                
                <!-- Quick Links -->
                <div class="footer-section">
                    <h3>Enlaces Rápidos</h3>
                    <ul class="footer-links">
                        <li><a href="index.html">Inicio</a></li>
                        <li><a href="productos.html">Productos</a></li>
                        <li><a href="categoria.html">Categorías</a></li>
                        <li><a href="nosotros.html">Nosotros</a></li>
                        <li><a href="contacto.html">Contacto</a></li>
                    </ul>
                </div>
                
                <!-- Categories -->
                <div class="footer-section">
                    <h3>Categorías</h3>
                    <ul class="footer-links">
                        <li><a href="categoria.html?cat=electrodomesticos">Electrodomésticos</a></li>
                        <li><a href="categoria.html?cat=tecnologia">Tecnología</a></li>
                        <li><a href="categoria.html?cat=hogar">Hogar y Jardín</a></li>
                        <li><a href="categoria.html?cat=deportes">Deportes</a></li>
                        <li><a href="categoria.html?cat=vehiculos">Vehículos</a></li>
                    </ul>
                </div>
                
                <!-- Contact Info -->
                <div class="footer-section">
                    <h3>Contacto</h3>
                    <div class="contact-info">
                        <div class="contact-item">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                            </svg>
                            <span>+51 123 456 789</span>
                        </div>
                        <div class="contact-item">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                <polyline points="22,6 12,13 2,6"></polyline>
                            </svg>
                            <span>info@credicalidda.com</span>
                        </div>
                        <div class="contact-item">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            <span>Lima, Perú</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer Bottom -->
            <div class="footer-bottom">
                <div class="footer-bottom-content">
                    <p>&copy; 2024 Credicálidda. Todos los derechos reservados.</p>
                    <div class="footer-legal">
                        <a href="politicas.html">Políticas de Privacidad</a>
                        <a href="terminos.html">Términos y Condiciones</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Contact Modal -->
    <div class="modal" id="contactModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Contactar Vendedor</h2>
                <button class="modal-close" onclick="FormManager.closeContactModal()" aria-label="Cerrar modal">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <form class="contact-form" id="contactForm">
                <div class="form-group">
                    <label for="contactName">Nombre completo *</label>
                    <input 
                        type="text" 
                        id="contactName" 
                        name="name" 
                        required 
                        aria-describedby="contactNameError"
                    >
                    <span class="error-message" id="contactNameError"></span>
                </div>
                
                <div class="form-group">
                    <label for="contactPhone">Teléfono *</label>
                    <input 
                        type="tel" 
                        id="contactPhone" 
                        name="phone" 
                        required 
                        aria-describedby="contactPhoneError"
                    >
                    <span class="error-message" id="contactPhoneError"></span>
                </div>
                
                <div class="form-group">
                    <label for="contactProduct">Producto de interés</label>
                    <input 
                        type="text" 
                        id="contactProduct" 
                        name="product" 
                        readonly
                    >
                </div>
                
                <div class="form-group">
                    <label for="contactMessage">Mensaje *</label>
                    <textarea 
                        id="contactMessage" 
                        name="message" 
                        rows="4" 
                        required 
                        aria-describedby="contactMessageError"
                    ></textarea>
                    <span class="error-message" id="contactMessageError"></span>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="FormManager.closeContactModal()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Enviar por WhatsApp
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/carousel.js"></script>
    <script src="js/products.js"></script>
    <script src="js/forms.js"></script>
    <script src="js/main.js"></script>
    
    <!-- Products Page Specific Script -->
    <script>
        // Products page functionality
        class ProductsPage {
            constructor() {
                this.currentFilters = {
                    categories: [],
                    priceRange: { min: 0, max: 50000 },
                    sortBy: 'featured',
                    searchQuery: ''
                };
                this.currentView = 'grid';
                this.currentPage = 1;
                this.itemsPerPage = 12;
                this.totalProducts = 0;
                this.allProducts = [];
                this.filteredProducts = [];
                
                this.init();
            }
            
            init() {
                this.setupFilterEvents();
                this.loadProducts();
                this.handleURLParams();
            }
            
            setupFilterEvents() {
                // Category filters
                const categoryFilters = Utils.$$('input[name="category"]');
                categoryFilters.forEach(filter => {
                    Utils.addEvent(filter, 'change', () => this.handleCategoryFilter());
                });
                
                // Price range
                const priceRange = Utils.$('#priceRange');
                const minPriceInput = Utils.$('#minPrice');
                const maxPriceInput = Utils.$('#maxPrice');
                
                if (priceRange) {
                    Utils.addEvent(priceRange, 'input', () => this.handlePriceFilter());
                }
                
                if (minPriceInput && maxPriceInput) {
                    Utils.addEvent(minPriceInput, 'input', () => this.handlePriceInputs());
                    Utils.addEvent(maxPriceInput, 'input', () => this.handlePriceInputs());
                }
                
                // Sort select
                const sortSelect = Utils.$('#sortSelect');
                if (sortSelect) {
                    Utils.addEvent(sortSelect, 'change', () => this.handleSort());
                }
                
                // View toggle
                const viewButtons = Utils.$$('.view-btn');
                viewButtons.forEach(btn => {
                    Utils.addEvent(btn, 'click', () => this.handleViewToggle(btn));
                });
                
                // Search
                const searchForm = Utils.$('.search-form');
                if (searchForm) {
                    Utils.addEvent(searchForm, 'submit', (e) => {
                        e.preventDefault();
                        this.handleSearch();
                    });
                }
                
                // Load more
                const loadMoreBtn = Utils.$('#loadMoreBtn');
                if (loadMoreBtn) {
                    Utils.addEvent(loadMoreBtn, 'click', () => this.loadMoreProducts());
                }
            }
            
            async loadProducts() {
                try {
                    this.showLoading(true);
                    
                    // Load products from ProductManager
                    this.allProducts = await ProductManager.getAllProducts();
                    this.applyFilters();
                    
                } catch (error) {
                    Utils.errorHandler.log(error, 'ProductsPage.loadProducts');
                    this.showError('Error al cargar los productos');
                } finally {
                    this.showLoading(false);
                }
            }
            
            applyFilters() {
                let filtered = [...this.allProducts];
                
                // Apply category filter
                if (this.currentFilters.categories.length > 0 && 
                    !this.currentFilters.categories.includes('all')) {
                    filtered = filtered.filter(product => 
                        this.currentFilters.categories.includes(product.category)
                    );
                }
                
                // Apply price filter
                filtered = filtered.filter(product => 
                    product.price >= this.currentFilters.priceRange.min &&
                    product.price <= this.currentFilters.priceRange.max
                );
                
                // Apply search filter
                if (this.currentFilters.searchQuery) {
                    const query = this.currentFilters.searchQuery.toLowerCase();
                    filtered = filtered.filter(product =>
                        product.name.toLowerCase().includes(query) ||
                        product.description.toLowerCase().includes(query) ||
                        product.category.toLowerCase().includes(query)
                    );
                }
                
                // Apply sorting
                this.sortProducts(filtered);
                
                this.filteredProducts = filtered;
                this.totalProducts = filtered.length;
                this.currentPage = 1;
                
                this.renderProducts();
                this.updateFilterTags();
                this.updateResultsCount();
            }
            
            sortProducts(products) {
                switch (this.currentFilters.sortBy) {
                    case 'price-low':
                        products.sort((a, b) => a.price - b.price);
                        break;
                    case 'price-high':
                        products.sort((a, b) => b.price - a.price);
                        break;
                    case 'name':
                        products.sort((a, b) => a.name.localeCompare(b.name));
                        break;
                    case 'newest':
                        products.sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded));
                        break;
                    default: // featured
                        products.sort((a, b) => (b.featured ? 1 : 0) - (a.featured ? 1 : 0));
                }
            }
            
            renderProducts() {
                const grid = Utils.$('#productsGrid');
                const noResults = Utils.$('#noResults');
                
                if (!grid) return;
                
                if (this.filteredProducts.length === 0) {
                    grid.innerHTML = '';
                    if (noResults) noResults.style.display = 'block';
                    return;
                }
                
                if (noResults) noResults.style.display = 'none';
                
                const startIndex = 0;
                const endIndex = this.currentPage * this.itemsPerPage;
                const productsToShow = this.filteredProducts.slice(startIndex, endIndex);
                
                grid.className = `products-grid ${this.currentView}-view`;
                grid.innerHTML = productsToShow.map(product => 
                    ProductManager.createProductCard(product)
                ).join('');
                
                // Setup product card events
                ProductManager.setupProductEvents();
                
                // Show/hide load more button
                this.updateLoadMoreButton();
            }
            
            updateLoadMoreButton() {
                const container = Utils.$('#loadMoreContainer');
                if (!container) return;
                
                const hasMore = this.currentPage * this.itemsPerPage < this.filteredProducts.length;
                container.style.display = hasMore ? 'block' : 'none';
            }
            
            loadMoreProducts() {
                this.currentPage++;
                const grid = Utils.$('#productsGrid');
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = this.currentPage * this.itemsPerPage;
                const newProducts = this.filteredProducts.slice(startIndex, endIndex);
                
                const newProductsHTML = newProducts.map(product => 
                    ProductManager.createProductCard(product)
                ).join('');
                
                grid.insertAdjacentHTML('beforeend', newProductsHTML);
                ProductManager.setupProductEvents();
                this.updateLoadMoreButton();
            }
            
            handleCategoryFilter() {
                const checkedCategories = Array.from(Utils.$$('input[name="category"]:checked'))
                    .map(input => input.value);
                
                this.currentFilters.categories = checkedCategories;
                this.applyFilters();
            }
            
            handlePriceFilter() {
                const priceRange = Utils.$('#priceRange');
                const value = parseInt(priceRange.value);
                
                this.currentFilters.priceRange.max = value;
                Utils.$('#maxPrice').value = value;
                
                this.applyFilters();
            }
            
            handlePriceInputs() {
                const minPrice = parseInt(Utils.$('#minPrice').value) || 0;
                const maxPrice = parseInt(Utils.$('#maxPrice').value) || 50000;
                
                this.currentFilters.priceRange.min = minPrice;
                this.currentFilters.priceRange.max = maxPrice;
                
                Utils.$('#priceRange').value = maxPrice;
                
                this.applyFilters();
            }
            
            handleSort() {
                const sortSelect = Utils.$('#sortSelect');
                this.currentFilters.sortBy = sortSelect.value;
                this.applyFilters();
            }
            
            handleViewToggle(clickedBtn) {
                const viewButtons = Utils.$$('.view-btn');
                viewButtons.forEach(btn => btn.classList.remove('active'));
                clickedBtn.classList.add('active');
                
                this.currentView = clickedBtn.dataset.view;
                this.renderProducts();
            }
            
            handleSearch() {
                const searchInput = Utils.$('#searchInput');
                this.currentFilters.searchQuery = searchInput.value.trim();
                this.applyFilters();
            }
            
            updateFilterTags() {
                const activeFiltersContainer = Utils.$('#activeFilters');
                const tagsContainer = Utils.$('.active-filter-tags');
                
                if (!activeFiltersContainer || !tagsContainer) return;
                
                const tags = [];
                
                // Category tags
                this.currentFilters.categories.forEach(category => {
                    if (category !== 'all') {
                        tags.push({
                            label: this.getCategoryLabel(category),
                            value: category,
                            type: 'category'
                        });
                    }
                });
                
                // Price range tag
                if (this.currentFilters.priceRange.min > 0 || 
                    this.currentFilters.priceRange.max < 50000) {
                    tags.push({
                        label: `S/ ${this.currentFilters.priceRange.min} - S/ ${this.currentFilters.priceRange.max}`,
                        value: 'price',
                        type: 'price'
                    });
                }
                
                // Search tag
                if (this.currentFilters.searchQuery) {
                    tags.push({
                        label: `"${this.currentFilters.searchQuery}"`,
                        value: 'search',
                        type: 'search'
                    });
                }
                
                if (tags.length > 0) {
                    tagsContainer.innerHTML = tags.map(tag => `
                        <span class="filter-tag" data-type="${tag.type}" data-value="${tag.value}">
                            ${tag.label}
                            <button onclick="ProductsPage.removeFilter('${tag.type}', '${tag.value}')" aria-label="Remover filtro">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </span>
                    `).join('');
                    
                    activeFiltersContainer.style.display = 'block';
                } else {
                    activeFiltersContainer.style.display = 'none';
                }
            }
            
            removeFilter(type, value) {
                switch (type) {
                    case 'category':
                        const categoryInput = Utils.$(`input[name="category"][value="${value}"]`);
                        if (categoryInput) categoryInput.checked = false;
                        break;
                    case 'price':
                        Utils.$('#minPrice').value = '';
                        Utils.$('#maxPrice').value = '';
                        Utils.$('#priceRange').value = 25000;
                        this.currentFilters.priceRange = { min: 0, max: 50000 };
                        break;
                    case 'search':
                        Utils.$('#searchInput').value = '';
                        this.currentFilters.searchQuery = '';
                        break;
                }
                
                this.applyFilters();
            }
            
            clearAllFilters() {
                // Reset category filters
                const categoryInputs = Utils.$$('input[name="category"]');
                categoryInputs.forEach(input => {
                    input.checked = input.value === 'all';
                });
                
                // Reset price filters
                Utils.$('#minPrice').value = '';
                Utils.$('#maxPrice').value = '';
                Utils.$('#priceRange').value = 25000;
                
                // Reset search
                Utils.$('#searchInput').value = '';
                
                // Reset sort
                Utils.$('#sortSelect').value = 'featured';
                
                // Reset filters object
                this.currentFilters = {
                    categories: ['all'],
                    priceRange: { min: 0, max: 50000 },
                    sortBy: 'featured',
                    searchQuery: ''
                };
                
                this.applyFilters();
            }
            
            getCategoryLabel(category) {
                const labels = {
                    'electrodomesticos': 'Electrodomésticos',
                    'tecnologia': 'Tecnología',
                    'hogar': 'Hogar y Jardín',
                    'deportes': 'Deportes',
                    'vehiculos': 'Vehículos'
                };
                return labels[category] || category;
            }
            
            updateResultsCount() {
                const countElement = Utils.$('#resultsCount');
                if (countElement) {
                    countElement.textContent = this.totalProducts;
                }
            }
            
            showLoading(show) {
                const loadingState = Utils.$('#loadingState');
                const grid = Utils.$('#productsGrid');
                
                if (loadingState) {
                    loadingState.style.display = show ? 'block' : 'none';
                }
                
                if (grid && show) {
                    grid.innerHTML = '';
                }
            }
            
            showError(message) {
                const grid = Utils.$('#productsGrid');
                if (grid) {
                    grid.innerHTML = `
                        <div class="error-state">
                            <p>${message}</p>
                            <button class="btn btn-primary" onclick="location.reload()">
                                Reintentar
                            </button>
                        </div>
                    `;
                }
            }
            
            handleURLParams() {
                const urlParams = new URLSearchParams(window.location.search);
                
                // Handle category from URL
                const category = urlParams.get('category');
                if (category) {
                    const categoryInput = Utils.$(`input[name="category"][value="${category}"]`);
                    if (categoryInput) {
                        // Uncheck "all" and check specific category
                        Utils.$('input[name="category"][value="all"]').checked = false;
                        categoryInput.checked = true;
                        this.handleCategoryFilter();
                    }
                }
                
                // Handle search from URL
                const search = urlParams.get('search') || urlParams.get('q');
                if (search) {
                    Utils.$('#searchInput').value = search;
                    this.handleSearch();
                }
            }
        }
        
        // Initialize products page when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            window.ProductsPage = new ProductsPage();
        });
    </script>
</body>
</html>
